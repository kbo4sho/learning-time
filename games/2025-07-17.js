let stage=document.getElementById("game-of-the-day-stage");stage.innerHTML="";let w=720,h=480;let c=document.createElement("canvas");c.width=w;c.height=h;c.style.display="block";c.style.margin="0 auto";stage.appendChild(c);let ctx=c.getContext("2d");let audioCtx=new(window.AudioContext||window.webkitAudioContext)();function playTone(freq,dur,type="sine",volume=0.1){let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type=type;o.frequency.value=freq;g.gain.setValueAtTime(volume,audioCtx.currentTime);o.connect(g);g.connect(audioCtx.destination);o.start();o.stop(audioCtx.currentTime+dur);}function playCorrect(){playTone(880,0.12,"triangle",0.12);setTimeout(()=>playTone(1240,0.1,"triangle",0.1),100);setTimeout(()=>playTone(1040,0.15,"triangle",0.14),220);}function playWrong(){playTone(260,0.4,"sawtooth",0.15);}function playBackgroundLoop(){let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type="triangle";o.frequency.value=180;o.connect(g);g.connect(audioCtx.destination);g.gain.setValueAtTime(0.015,audioCtx.currentTime);o.start();let baseFreq=180;let t=audioCtx.currentTime;function modFreq(){let now=audioCtx.currentTime;if(now-t>8){t=now;let mod=5+Math.sin(now)*15;o.frequency.setValueAtTime(baseFreq+mod,now)}requestAnimationFrame(modFreq);}modFreq();return()=>{o.stop();}}let stopBg=playBackgroundLoop();let characters=[];let explorer={x:360,y:240,size:48,color:"#3366CC",path:[],mathQuestion:null,answerOptions:[],score:0,sparklePhase:0};let itemsToFind=[{name:"Wooden Log",value:5},{name:"Shiny Pebble",value:3},{name:"Fruit Basket",value:7},{name:"Magic Leaf",value:4},{name:"Lantern",value:6}];function createCharacter(x,y,name,color){return{id:"char"+(Math.random()*99999|0),x,y,name,color}};characters.push(createCharacter(130,380,"Lumpy the Traveler","#E89336"));characters.push(createCharacter(610,110,"Zara the Wise Owl","#9E8BFF"));characters.push(createCharacter(170,90,"Bumble the Friendly Bee","#F9BF6F"));function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}function drawExplorer(){ctx.save();ctx.translate(explorer.x,explorer.y);explorer.sparklePhase+=0.03;if(explorer.sparklePhase>Math.PI*2)explorer.sparklePhase-=Math.PI*2;let sh=Math.sin(explorer.sparklePhase)*6+6;let sw=Math.cos(explorer.sparklePhase)*6+6;for(let i=0;i<5;i++){ctx.beginPath();ctx.strokeStyle=`rgba(255, 255, 255, ${0.15*(5-i)})`;ctx.lineWidth=2;ctx.moveTo(Math.cos(i*Math.PI*2/5)*sw,Math.sin(i*Math.PI*2/5)*sh);ctx.lineTo(Math.cos(i*Math.PI*2/5)*sw*1.8,Math.sin(i*Math.PI*2/5)*sh*1.8);ctx.stroke();}ctx.fillStyle=explorer.color;ctx.beginPath();ctx.shadowColor="rgba(50,70,150,0.5)";ctx.shadowBlur=15;ctx.arc(0,0,explorer.size/2,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#FFF";ctx.beginPath();ctx.arc(-10,-6,8,0,Math.PI*2);ctx.arc(12,-6,8,0,Math.PI*2);ctx.fill();ctx.fillStyle="#000";ctx.beginPath();ctx.arc(-11,-6,4,0,Math.PI*2);ctx.arc(13,-6,4,0,Math.PI*2);ctx.fill();ctx.strokeStyle="#444";ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(0,explorer.size*0.25);ctx.lineTo(19,explorer.size*0.45);ctx.stroke();ctx.restore();}function drawChar(c){ctx.save();ctx.translate(c.x,c.y);ctx.fillStyle=c.color;ctx.shadowColor="rgba(0,0,0,0.12)";ctx.shadowBlur=8;ctx.beginPath();ctx.ellipse(0,0,32,42,0,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#FFF";ctx.beginPath();ctx.ellipse(-12,-15,14,18,0,0,Math.PI*2);ctx.ellipse(12,-15,14,18,0,0,Math.PI*2);ctx.fill();ctx.fillStyle="#000";ctx.beginPath();ctx.ellipse(-12,-15,7,9,0,0,Math.PI*2);ctx.ellipse(12,-15,7,9,0,0,Math.PI*2);ctx.fill();ctx.fillStyle="#FFF";ctx.font="16px Comic Sans MS";ctx.textAlign="center";ctx.shadowColor="rgba(0,0,0,0.3)";ctx.shadowBlur=2;ctx.fillText(c.name,0,52);ctx.shadowBlur=0;ctx.restore();}function drawItem(x,y,name){ctx.save();ctx.shadowColor="rgba(0,0,0,0.18)";ctx.shadowBlur=8;ctx.fillStyle="#A3D68A";ctx.beginPath();ctx.ellipse(x,y,27,17,Math.sin(Date.now()*0.001)*0.1,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#587B22";ctx.font="bold 13px Comic Sans MS";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText(name,x,y+3);ctx.restore();}function newMathQuestion(){let item=itemsToFind[randomInt(0,itemsToFind.length-1)];let a=item.value;let b=randomInt(1,9);let correct=a+b;let options=[correct];while(options.length<4){let option=randomInt(correct-3,correct+3);if(option>0&&!options.includes(option))options.push(option);}options.sort(()=>Math.random()-0.5);explorer.mathQuestion={text:"Lumpy asks: "+a+" + "+b+" = ? ",correct:correct};explorer.answerOptions=options;explorer.currentItem=item;}function checkAnswer(ans){if(ans===explorer.mathQuestion.correct){explorer.score++;playCorrect();newMathQuestion();}else{playWrong();}}let mouseX,mouseY,clicked=false;c.addEventListener("mousemove",e=>{let r=c.getBoundingClientRect();mouseX=e.clientX-r.left;mouseY=e.clientY-r.top;});c.addEventListener("click",e=>{clicked=true;if(audioCtx.state==="suspended")audioCtx.resume();});newMathQuestion();function drawBackground(){let grd=ctx.createLinearGradient(0,0,0,h);grd.addColorStop(0,"#BCE6F7");grd.addColorStop(1,"#4D9A2A");ctx.fillStyle=grd;ctx.fillRect(0,0,w,h);for(let i=10;i<720;i+=40){ctx.strokeStyle=`rgba(255,255,255,${0.05+0.03*Math.sin((i+Date.now()*0.05)*0.1)})`;ctx.lineWidth=3+2*Math.cos(i*0.05+Date.now()*0.002);ctx.beginPath();ctx.moveTo(i,480);ctx.lineTo(i-40,440);ctx.stroke();}}function draw(){ctx.clearRect(0,0,w,h);drawBackground();drawChar(characters[0]);drawChar(characters[1]);drawChar(characters[2]);drawExplorer();drawItem(600,430,explorer.currentItem.name);ctx.fillStyle="#222";ctx.font="bold 20px Comic Sans MS";ctx.textAlign="left";ctx.shadowColor="rgba(255,255,255,0.7)";ctx.shadowBlur=3;ctx.fillText(explorer.mathQuestion.text,24,34);ctx.shadowBlur=0;let startX=20;let startY=60;explorer.answerOptions.forEach((opt,i)=>{let bx=startX+i*160;let by=startY;ctx.fillStyle="#FFFFCC";ctx.strokeStyle="#C4A900";ctx.lineWidth=4;ctx.beginPath();ctx.roundRect(bx,by,140,52,12);ctx.fill();ctx.stroke();ctx.fillStyle="#222";ctx.font="bold 30px Comic Sans MS";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText(opt,bx+70,by+26);if(mouseX>bx&&mouseX<bx+140&&mouseY>by&&mouseY<by+52){ctx.fillStyle="rgba(255,255,255,0.35)";ctx.fillRect(bx,by,140,52);}});ctx.fillStyle="#004488";ctx.font="22px Comic Sans MS";ctx.textAlign="right";ctx.textBaseline="top";ctx.fillText("Score: "+explorer.score,690,40);}function loop(){draw();if(clicked){clicked=false;let startX=20;let startY=60;for(let i=0;i<explorer.answerOptions.length;i++){let bx=startX+i*160;let by=startY;if(mouseX>bx&&mouseX<bx+140&&mouseY>by&&mouseY<by+52){checkAnswer(explorer.answerOptions[i]);break;}}}requestAnimationFrame(loop);}loop();CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r){if(w<2*r)r=w/2;if(h<2*r)r=h/2;this.beginPath();this.moveTo(x+r,y);this.arcTo(x+w,y,x+w,y+h,r);this.arcTo(x+w,y+h,x,y+h,r);this.arcTo(x,y+h,x,y,r);this.arcTo(x,y,x+r,y,r);this.closePath();return this;}