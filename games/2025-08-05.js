const stage = document.getElementById('game-of-the-day-stage');stage.innerHTML = '';const W = 720,H = 480;const canvas = document.createElement('canvas');canvas.width = W;canvas.height = H;stage.appendChild(canvas);const ctx = canvas.getContext('2d');const bgMusic = new Audio('https://cdn.pixabay.com/download/audio/2022/02/11/audio_156881131ec.mp3?filename=magical-fairyland-ambient-25918.mp3');bgMusic.loop = true;bgMusic.volume = 0.07;bgMusic.play().catch(()=>{});const correctSound = new Audio('https://cdn.pixabay.com/download/audio/2021/11/23/audio_1a6818802f.mp3?filename=game-treasure-collect-6289.mp3');correctSound.volume=0.5;const wrongSound = new Audio('https://cdn.pixabay.com/download/audio/2021/09/27/audio_258a3497d0.mp3?filename=error-fail-6050.mp3');wrongSound.volume=0.4;class Explorer{constructor(){this.x = W/2;this.y = H/2;this.size = 48;this.speed = 3;this.dir = {left:false,right:false,up:false,down:false};this.image = new Image();this.image.src = 'https://cdn-icons-png.flaticon.com/512/3059/3059651.png';this.sparkles=[];}update(){if(this.dir.left)this.x-=this.speed;if(this.dir.right)this.x+=this.speed;if(this.dir.up)this.y-=this.speed;if(this.dir.down)this.y+=this.speed;this.x = Math.min(Math.max(this.size/2,this.x),W-this.size/2);this.y = Math.min(Math.max(this.size/2,this.y),H-this.size/2);if(Math.random()<0.3){this.sparkles.push({x:this.x+(Math.random()-0.5)*this.size,y:this.y+(Math.random()-0.5)*this.size,r:Math.random()*2+1,life:20});}for(let i=this.sparkles.length-1;i>=0;i--){let p=this.sparkles[i];p.life--;p.r+=0.1;if(p.life<=0)this.sparkles.splice(i,1);}}draw(){for(let p of this.sparkles){ctx.beginPath();let alpha = p.life/20;ctx.fillStyle = `rgba(255,255,180,${alpha})`;ctx.shadowColor='rgba(255,255,200,0.7)';ctx.shadowBlur=8;ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;}ctx.shadowColor='rgba(0,0,0,0.3)';ctx.shadowBlur=6;ctx.drawImage(this.image,this.x-this.size/2,this.y-this.size/2,this.size,this.size);ctx.shadowBlur=0;}}class FriendlyAlien{constructor(x,y,question){this.x = x;this.y = y;this.size = 50;this.color = '#ff77aa';this.question = question;this.answered = false;this.image = new Image();this.image.src = 'https://cdn-icons-png.flaticon.com/512/616/616490.png';this.bobPhase=0;}draw(){this.bobPhase+=0.05;let bobOffset = Math.sin(this.bobPhase)*5;ctx.save();ctx.translate(this.x,this.y+bobOffset);ctx.shadowColor = 'rgba(255,102,153,0.8)';ctx.shadowBlur = 12;ctx.drawImage(this.image,-this.size/2,-this.size/2,this.size,this.size);ctx.restore();ctx.fillStyle = this.color;ctx.font = '16px Comic Sans MS';ctx.textAlign = 'center';ctx.shadowColor='rgba(0,0,0,0.5)';ctx.shadowBlur=4;if(!this.answered){ctx.fillText(this.question.text,this.x,this.y - this.size - 10);}else{ctx.fillStyle = '#00cc00';ctx.fillText('Thanks!',this.x,this.y - this.size - 10);}ctx.shadowBlur=0;}isTouched(x,y){return !this.answered && Math.hypot(x - this.x,y - this.y) < this.size;}class NumberStone{constructor(x,y,value){this.x = x;this.y = y;this.size = 44;this.value = value;this.collected = false;this.color = '#74b49b';this.gradient = null;this.shimmerPhase=0;this.shimmerSpeed=0.04;this.canvasStone = document.createElement('canvas');this.canvasStone.width = this.canvasStone.height = this.size;const cctx = this.canvasStone.getContext('2d');let grad = cctx.createRadialGradient(this.size/2,this.size/2,this.size/4,this.size/2,this.size/2,this.size/2);grad.addColorStop(0,'#a1d0c3');grad.addColorStop(1,'#3b7a57');cctx.fillStyle=grad;cctx.beginPath();cctx.ellipse(this.size/2,this.size/2,this.size*0.4,this.size*0.45,0,0,Math.PI*2);cctx.fill();cctx.strokeStyle='#2e5e40';cctx.lineWidth=3;cctx.beginPath();cctx.ellipse(this.size/2,this.size/2,this.size*0.4,this.size*0.45,0,0,Math.PI*2);cctx.stroke();cctx.fillStyle = '#034732';cctx.font = 'bold 20px Comic Sans MS';cctx.textAlign = 'center';cctx.textBaseline = 'middle';cctx.fillText(this.value,this.size/2,this.size/2+1);}draw(){if(this.collected)return;this.shimmerPhase+=this.shimmerSpeed;let glowAlpha = 0.2+0.2*Math.sin(this.shimmerPhase*6);ctx.shadowColor = `rgba(100,220,180,${glowAlpha})`;ctx.shadowBlur=12;ctx.drawImage(this.canvasStone,this.x-this.size/2,this.y-this.size/2,this.size,this.size);ctx.shadowBlur=0;ctx.fillStyle = '#013c2a';ctx.font = 'bold 22px Comic Sans MS';ctx.textAlign = 'center';ctx.textBaseline = 'middle';ctx.fillText(this.value,this.x,this.y+2);}isTouched(x,y){return !this.collected && Math.hypot(x - this.x,y - this.y) < this.size;}class Game{constructor(){this.explorer = new Explorer();this.aliens = [];this.stones = [];this.currentQuestion = null;this.score = 0;this.awaitingAnswer = false;this.message = '';this.messageTimer = 0;this.backgroundImage = new Image();this.backgroundImage.src = 'https://i.ibb.co/GMb87fk/wacky-fantasy-land.png';this.stars=[];for(let i=0;i<80;i++){this.stars.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.4+0.4,alpha:Math.random(),dAlpha:Math.random()*0.01+0.002});}const mathQuestions = [{text:'Find 5 stones',target:5},{text:'Find 7 stones',target:7},{text:'Find 3 stones',target:3},{text:'Find 9 stones',target:9}];for(let i=0;i<4;i++){const q = mathQuestions[i];const x = 120 + i*150;const y = 80 + (i%2)*260;this.aliens.push(new FriendlyAlien(x,y,q));}for(let n=1;n<=9;n++){let x,y,valid;do{x = 60 + Math.random()*(W-120);y = 120 + Math.random()*(H-160);valid = true;for(let st of this.stones){if(Math.hypot(x - st.x,y - st.y) < 50) valid=false;}for(let al of this.aliens){if(Math.hypot(x - al.x,y - al.y) < 70) valid=false;}}while(!valid);this.stones.push(new NumberStone(x,y,n));}this.bindKeys();this.bindClicks();this.loop();}bindKeys(){window.addEventListener('keydown',e=>{if(e.key==='ArrowLeft' || e.key==='a'){this.explorer.dir.left=true;}if(e.key==='ArrowRight' || e.key==='d'){this.explorer.dir.right=true;}if(e.key==='ArrowUp' || e.key==='w'){this.explorer.dir.up=true;}if(e.key==='ArrowDown' || e.key==='s'){this.explorer.dir.down=true;}});window.addEventListener('keyup',e=>{if(e.key==='ArrowLeft' || e.key==='a'){this.explorer.dir.left=false;}if(e.key==='ArrowRight' || e.key==='d'){this.explorer.dir.right=false;}if(e.key==='ArrowUp' || e.key==='w'){this.explorer.dir.up=false;}if(e.key==='ArrowDown' || e.key==='s'){this.explorer.dir.down=false;}});}bindClicks(){canvas.addEventListener('click',e=>{const rect = canvas.getBoundingClientRect();const clickX = e.clientX - rect.left;const clickY = e.clientY - rect.top;if(this.awaitingAnswer){for(let stone of this.stones){if(stone.isTouched(clickX,clickY)){if(stone.value === this.currentQuestion.target){correctSound.currentTime=0;correctSound.play();stone.collected = true;this.score++;this.message = 'Great job! Stone collected!';this.messageTimer = 120;for(let alien of this.aliens){if(alien.question === this.currentQuestion) alien.answered = true;}this.awaitingAnswer = false;this.currentQuestion = null;}else{wrongSound.currentTime=0;wrongSound.play();this.message = 'Oops! That stone doesn\'t match the number.';this.messageTimer = 120;}}}}return;}for(let alien of this.aliens){if(alien.isTouched(clickX,clickY) && !alien.answered){this.currentQuestion = alien.question;this.awaitingAnswer = true;this.message = 'Find the stones with number '+this.currentQuestion.target+'. Click them!';this.messageTimer = 180;break;}}});}drawBackground(){ctx.fillStyle = '#1c2f2f';ctx.fillRect(0,0,W,H);for(let s of this.stars){s.alpha+=s.dAlpha;if(s.alpha>1){s.alpha=1;s.dAlpha*=-1;}else if(s.alpha<0.1){s.alpha=0.1;s.dAlpha*=-1;}ctx.beginPath();ctx.fillStyle = `rgba(255,255,230,${s.alpha})`;ctx.shadowColor = `rgba(255,255,230,${s.alpha*1.4})`;ctx.shadowBlur = 5;ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;}ctx.drawImage(this.backgroundImage,0,0,W,H);}drawHUD(){ctx.fillStyle = '#efefef';ctx.font = '28px Comic Sans MS';ctx.textAlign = 'left';ctx.shadowColor='rgba(0,0,0,0.4)';ctx.shadowBlur=4;ctx.fillText('Score: '+this.score, 15, 34);ctx.shadowBlur=0;if(this.awaitingAnswer && this.currentQuestion){ctx.fillStyle = '#ffc2d1';ctx.font = '24px Comic Sans MS';ctx.textAlign = 'center';ctx.shadowColor='rgba(255,182,193,0.8)';ctx.shadowBlur=5;ctx.fillText(this.message, W/2, 62);}else if(this.messageTimer > 0){ctx.fillStyle = '#ffb3c6';ctx.font = '22px Comic Sans MS';ctx.textAlign = 'center';ctx.shadowColor='rgba(255,180,200,0.7)';ctx.shadowBlur=4;ctx.fillText(this.message, W/2, 60);this.messageTimer--;}ctx.shadowBlur=0;ctx.fillStyle = '#d0e6d2';ctx.font = '18px Comic Sans MS';ctx.textAlign = 'left';ctx.fillText('Use arrow keys or WASD to move Explorer.',15,H-42);ctx.fillText('Click friendly aliens to get tasks!',15,H-20);}update(){this.explorer.update();}draw(){this.drawBackground();for(let alien of this.aliens){alien.draw();}for(let stone of this.stones){stone.draw();}this.explorer.draw();this.drawHUD();}loop(){this.update();this.draw();requestAnimationFrame(()=>this.loop());}}new Game();