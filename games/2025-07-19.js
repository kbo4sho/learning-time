let stage=document.getElementById("game-of-the-day-stage");stage.innerHTML="";let c=document.createElement("canvas");c.width=720;c.height=480;stage.appendChild(c);let ctx=c.getContext("2d");let score=0;let lives=3;let exploring=false;let collected=0;let totalTreasures=5;let treasures=[];let player={x:360,y:240,r:22,speed:4};let keys={};let messages=["Find all treasures on the island! Answer math clues to open them.","Great! You found a treasure!","Oops, wrong answer! Try again.","You collected all treasures! Well done explorer!"];let sounds={correct:null,wrong:null,collect:null,bgm:null};let audioCtx=null;function getAudioContext(){if(!audioCtx){audioCtx=new(window.AudioContext||window.webkitAudioContext)()}return audioCtx}function playCorrect(){let ac=getAudioContext();let o=ac.createOscillator();let g=ac.createGain();o.type="square";o.frequency.setValueAtTime(660,ac.currentTime);g.gain.setValueAtTime(0.06,ac.currentTime);o.connect(g);g.connect(ac.destination);o.start();g.gain.exponentialRampToValueAtTime(0.0001,ac.currentTime+0.25);o.stop(ac.currentTime+0.25)}function playWrong(){let ac=getAudioContext();let o=ac.createOscillator();let g=ac.createGain();o.type="sawtooth";o.frequency.setValueAtTime(220,ac.currentTime);g.gain.setValueAtTime(0.05,ac.currentTime);o.connect(g);g.connect(ac.destination);o.start();g.gain.exponentialRampToValueAtTime(0.0001,ac.currentTime+0.5);o.stop(ac.currentTime+0.5)}function playCollect(){let ac=getAudioContext();let o=ac.createOscillator();let g=ac.createGain();o.type="triangle";o.frequency.setValueAtTime(880,ac.currentTime);g.gain.setValueAtTime(0.08,ac.currentTime);o.connect(g);g.connect(ac.destination);o.start();g.gain.exponentialRampToValueAtTime(0.0001,ac.currentTime+0.18);o.stop(ac.currentTime+0.18)}function createBackgroundMusic(){let ac=getAudioContext();let g=ac.createGain();g.gain.value=0.03;g.connect(ac.destination);let o1=ac.createOscillator();let o2=ac.createOscillator();let o3=ac.createOscillator();o1.type="triangle";o2.type="sine";o3.type="sine";o1.frequency.value=110;o2.frequency.value=220;o3.frequency.value=440;o1.connect(g);o2.connect(g);o3.connect(g);o1.start();o2.start();o3.start();return{ac,g,o1,o2,o3}}let bgm=createBackgroundMusic();function dist(x1,y1,x2,y2){return Math.sqrt((x2-x1)**2+(y2-y1)**2)}function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}function generateTreasures(){treasures=[];let used=[];while(treasures.length<totalTreasures){let tx=randomInt(60,660);let ty=randomInt(60,420);let ok=true;for(let u of used){if(dist(tx,ty,u.x,u.y)<120)ok=false;}if(ok)used.push({x:tx,y:ty}),treasures.push({x:tx,y:ty,found:false,question:"",answer:0,open:false,anim:0})}}function generateQuestion(){let a=randomInt(1,10);let b=randomInt(1,10);let op=randomInt(0,1)?"plus":"minus";if(op==="plus")return{name:""+a+" + "+b,a:a+b};else{if(a<b)[a,b]=[b,a];return{name:""+a+" - "+b,a:a-b;}}}let currentTreasure=null;let questionActive=false;let inputAnswer="";let pulseTime=0;function drawPlayer(){pulseTime+=0.04;let pr=player.r+2*Math.sin(pulseTime);ctx.beginPath();ctx.shadowColor="rgba(74,144,226,0.6)";ctx.shadowBlur=18;ctx.fillStyle="rgba(74,144,226,0.9)";ctx.arc(player.x,player.y,pr,0,2*Math.PI);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#FFFFFF";ctx.font="bold 26px Comic Sans MS";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("ðŸ‘£",player.x,player.y+2)}function drawTreasure(t){t.anim+=0.06;if(t.anim>Math.PI*2)t.anim=0;let scale=1+0.12*Math.sin(t.anim);ctx.save();ctx.translate(t.x,t.y);ctx.scale(scale,scale);ctx.beginPath();ctx.shadowColor="rgba(155,89,182,0.7)";ctx.shadowBlur=22;ctx.fillStyle=t.found?"#FFDC00":"#9B59B6";ctx.arc(0,0,20,0,2*Math.PI);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle=t.found?"#333":"#FFF";ctx.font="bold 22px Comic Sans MS";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("ðŸ’Ž",0,0);ctx.restore()}function drawBackground(){let grd=ctx.createLinearGradient(0,0,0,480);grd.addColorStop(0,"#0077be");grd.addColorStop(1,"#3cb371");ctx.fillStyle=grd;ctx.fillRect(0,0,720,480);for(let i=0;i<720;i+=40){for(let j=0;j<480;j+=40){ctx.beginPath();ctx.fillStyle="rgba(60,179,113,0.1)";ctx.moveTo(i,j+15);ctx.lineTo(i+10,j+5);ctx.lineTo(i+25,j+20);ctx.closePath();ctx.fill()}}ctx.beginPath();ctx.shadowColor="rgba(255,255,255,0.15)";ctx.shadowBlur=35;ctx.fillStyle="rgba(255,255,255,0.08)";ctx.ellipse(360,440,300,40,0,0,2*Math.PI);ctx.fill();ctx.shadowBlur=0}function drawHUD(){ctx.fillStyle="#1B2631";ctx.font="bold 28px Comic Sans MS";ctx.textAlign="left";ctx.shadowColor="rgba(255,255,255,0.2)";ctx.shadowBlur=2;ctx.fillText("Exploration Math Island",20,34);ctx.font="20px Comic Sans MS";ctx.fillText(`Treasures: ${collected} / ${totalTreasures}`,20,70);ctx.fillText(`Lives: ${lives}`,20,100);ctx.shadowBlur=0;if(questionActive&&currentTreasure){ctx.fillStyle="rgba(255,255,255,0.95)";ctx.shadowColor="rgba(155,89,182,0.8)";ctx.shadowBlur=12;ctx.fillRect(120,368,480,84);ctx.shadowBlur=0;ctx.strokeStyle="#9B59B6";ctx.lineWidth=5;ctx.strokeRect(120,368,480,84);ctx.fillStyle="#2C3E50";ctx.font="bold 34px Comic Sans MS";ctx.textAlign="center";ctx.fillText(`Solve: ${currentTreasure.question}`,360,404);ctx.font="30px Comic Sans MS";ctx.fillText(inputAnswer||"_",360,445)}}function showMessage(text){ctx.fillStyle="rgba(20,20,20,0.75)";ctx.shadowColor="rgba(243,156,18,0.8)";ctx.shadowBlur=10;ctx.fillRect(140,190,440,100);ctx.shadowBlur=0;ctx.strokeStyle="#E67E22";ctx.lineWidth=4;ctx.strokeRect(140,190,440,100);ctx.fillStyle="#F39C12";ctx.font="bold 30px Comic Sans MS";ctx.textAlign="center";ctx.fillText(text,360,250)}function startQuestion(t){currentTreasure=t;questionActive=true;inputAnswer="";}function checkAnswer(){if(inputAnswer==="")return;let ans=parseInt(inputAnswer);if(ans===currentTreasure.answer){playCollect();currentTreasure.found=true;collected++;questionActive=false;currentTreasure=null;if(collected===totalTreasures)setTimeout(()=>alert(messages[3]),200);else setTimeout(()=>alert(messages[1]),200)}else{playWrong();lives--;if(lives<=0){alert("Oh no! You ran out of lives! Refresh to try again.");document.removeEventListener("keydown",keyDownHandler);document.removeEventListener("keyup",keyUpHandler);}else alert(messages[2]);inputAnswer=""}}function movePlayer(){if(keys.ArrowUp)player.y-=player.speed;if(keys.ArrowDown)player.y+=player.speed;if(keys.ArrowLeft)player.x-=player.speed;if(keys.ArrowRight)player.x+=player.speed;player.x=Math.min(700,Math.max(20,player.x));player.y=Math.min(460,Math.max(20,player.y))}function nearbyTreasure(){for(let t of treasures){if(!t.found&&dist(player.x,player.y,t.x,t.y)<52)return t;}return null}function draw(){ctx.clearRect(0,0,720,480);drawBackground();for(let t of treasures)drawTreasure(t);drawPlayer();drawHUD();if(!questionActive){let near=nearbyTreasure();if(near)startQuestion(near);}else{showMessage("Answer with number keys and Enter")}}function gameLoop(){if(lives>0){if(!questionActive)movePlayer();draw();requestAnimationFrame(gameLoop)}}function keyDownHandler(e){if(e.key.startsWith("Arrow")){keys[e.key]=true;e.preventDefault()}else if(questionActive){if(e.key>="0"&&e.key<="9"){if(inputAnswer.length<3)inputAnswer+=e.key} else if(e.key==="Backspace"){inputAnswer=inputAnswer.slice(0,-1)} else if(e.key==="Enter"){checkAnswer()}e.preventDefault()}}}function keyUpHandler(e){if(e.key.startsWith("Arrow"))keys[e.key]=false}function setupQuestions(){for(let t of treasures){let q=generateQuestion();t.question=q.name;t.answer=q.a}}generateTreasures();setupQuestions();document.addEventListener("keydown",keyDownHandler);document.addEventListener("keyup",keyUpHandler);alert(messages[0]);gameLoop()