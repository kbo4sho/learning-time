const stage=document.getElementById("game-of-the-day-stage");stage.innerHTML="";const canvas=document.createElement("canvas");canvas.width=720;canvas.height=480;stage.appendChild(canvas);const ctx=canvas.getContext("2d");const sounds={correct:new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"),incorrect:new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg"),bg:new Audio("https://actions.google.com/sounds/v1/ambiences/underwater.ogg")};sounds.bg.loop=true;sounds.bg.volume=0.15;sounds.bg.play();const rippleCanvas=document.createElement("canvas");rippleCanvas.width=720;rippleCanvas.height=480;const rippleCtx=rippleCanvas.getContext("2d");const rippleWaves=[];function createRipple(x,y){rippleWaves.push({x,y,r:0,a:0.5})}const explorer={x:360,y:240,size:42,color:"#4a90e2",dir:"down",frame:0,frameTick:0,wobble:0};const animals=[{x:150,y:100,size:54,color:"#f39c12",name:"Zazu",mathQ:null,asked:false},{x:550,y:350,size:54,color:"#c0392b",name:"Tika",mathQ:null,asked:false},{x:300,y:400,size:54,color:"#27ae60",name:"Momo",mathQ:null,asked:false}];let currentQuestion=null;let inputAnswer="";let message="";let messageTimer=0;let keys={ArrowUp:false,ArrowDown:false,ArrowLeft:false,ArrowRight:false,Enter:false,Backspace:false};const mathConcept="addition";function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}function generateQuestion(){const a=randomInt(1,10);const b=randomInt(1,10);return{a,b,answer:a+b,text:`${a} + ${b} = ?`}}function drawBackground(){ctx.fillStyle="linear-gradient(0deg, #0575e6 0%, #00f260 100%)";const grad=ctx.createLinearGradient(0,0,0,480);grad.addColorStop(0,"#7bdff2");grad.addColorStop(0.5,"#adebeb");grad.addColorStop(1,"#528a3b");ctx.fillStyle=grad;ctx.fillRect(0,0,720,480);ctx.fillStyle="#3b5a0d";ctx.fillRect(0,460,720,20);}function drawPath(){ctx.strokeStyle="#c8d67a";ctx.lineWidth=4;ctx.lineCap="round";ctx.beginPath();ctx.moveTo(360,480);ctx.bezierCurveTo(350,400,370,320,320,280);ctx.bezierCurveTo(290,250,170,230,150,320);ctx.moveTo(320,280);ctx.bezierCurveTo(350,270,600,270,570,340);ctx.stroke();}function drawExplorer(){explorer.wobble+=0.15;ctx.save();ctx.translate(explorer.x,explorer.y);ctx.rotate(Math.sin(explorer.wobble)*0.05);const grd=ctx.createRadialGradient(0,-explorer.size*0.3,explorer.size*0.1,0,0,explorer.size*0.8);grd.addColorStop(0,"#7ab8ff");grd.addColorStop(1,explorer.color);ctx.fillStyle=grd;ctx.beginPath();ctx.ellipse(0,0,explorer.size*0.6,explorer.size*0.8,0,0,Math.PI*2);ctx.shadowColor="rgba(0,0,0,0.25)";ctx.shadowBlur=10;ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#222";ctx.beginPath();const eyeX=(explorer.frame%2===0?5:-5)+Math.sin(explorer.wobble)*2;ctx.ellipse(eyeX,-5,8,11,0,0,Math.PI*2);ctx.fill();ctx.fillStyle="#fff";ctx.beginPath();ctx.ellipse(eyeX-2,-7.5,3,4,0,0,Math.PI*2);ctx.fill();ctx.restore();}function drawAnimals(){animals.forEach(a=>{const pulse=1+0.05*Math.sin(Date.now()/500+(a.x+a.y)/50);ctx.save();ctx.translate(a.x,a.y);ctx.scale(pulse,pulse);ctx.shadowColor="rgba(0,0,0,0.2)";ctx.shadowBlur=6;ctx.fillStyle=a.color;ctx.beginPath();ctx.moveTo(0,-a.size*0.45);ctx.lineTo(a.size*0.35,a.size*0.45);ctx.lineTo(-a.size*0.35,a.size*0.45);ctx.closePath();ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#1c1c1c";ctx.beginPath();ctx.ellipse(-a.size*0.1,-a.size*0.15,9,13,0,0,Math.PI*2);ctx.ellipse(a.size*0.1,-a.size*0.15,9,13,0,0,Math.PI*2);ctx.fill();ctx.fillStyle="#fff";ctx.beginPath();ctx.ellipse(-a.size*0.13,-a.size*0.18,4,6,0,0,Math.PI*2);ctx.ellipse(a.size*0.07,-a.size*0.18,4,6,0,0,Math.PI*2);ctx.fill();ctx.restore();ctx.fillStyle="#222";ctx.font="20px Comic Sans MS";ctx.textAlign="center";ctx.shadowColor="rgba(0,0,0,0.25)";ctx.shadowBlur=2;ctx.fillText(a.name,a.x,a.y+a.size+22);ctx.shadowBlur=0;})}function drawUI(){if(currentQuestion){ctx.fillStyle="rgba(250,240,210,0.95)";ctx.shadowColor="rgba(0,0,0,0.15)";ctx.shadowBlur=12;ctx.fillRect(110,165,500,150);ctx.shadowBlur=0;ctx.strokeStyle="#937a21";ctx.lineWidth=5;ctx.strokeRect(110,165,500,150);ctx.fillStyle="#5a3e00";ctx.font="36px Comic Sans MS";ctx.textAlign="center";ctx.fillText(currentQuestion.text,360,225);ctx.fillStyle="#2c662d";ctx.font="44px Comic Sans MS";ctx.fillText(inputAnswer||"_",360,290);}if(message){ctx.fillStyle="rgba(255,255,255,0.9)";ctx.shadowColor="rgba(0,0,0,0.12)";ctx.shadowBlur=10;ctx.fillRect(180,345,360,90);ctx.shadowBlur=0;ctx.strokeStyle="#bb7733";ctx.lineWidth=4;ctx.strokeRect(180,345,360,90);ctx.fillStyle="#663300";ctx.font="26px Comic Sans MS";ctx.textAlign="center";ctx.fillText(message,360,395);}}function intersectionDist(ax,ay,bx,by,r){const dx=bx-ax;const dy=by-ay;return Math.sqrt(dx*dx+dy*dy)<r;}function handleInteractions(){if(currentQuestion)return;for(let a of animals){if(!a.asked&&intersectionDist(explorer.x,explorer.y,a.x,a.y,a.size+explorer.size*0.5)){currentQuestion=generateQuestion();a.mathQ=currentQuestion;a.asked=true;inputAnswer="";message="";createRipple(a.x,a.y);break;}}}function updateExplorer(){const speed=3.2;if(keys.ArrowUp)explorer.y-=speed;if(keys.ArrowDown)explorer.y+=speed;if(keys.ArrowLeft)explorer.x-=speed;if(keys.ArrowRight)explorer.x+=speed;explorer.x=Math.min(Math.max(explorer.size/2,explorer.x),720-explorer.size/2);explorer.y=Math.min(Math.max(explorer.size/2,explorer.y),480-explorer.size/2);explorer.frameTick++;if(explorer.frameTick>8){explorer.frameTick=0;explorer.frame=(explorer.frame+1)%4;}}function updateRipples(){rippleCtx.clearRect(0,0,720,480);for(let i=rippleWaves.length-1;i>=0;i--){const r=w=rippleWaves[i];r.r+=2.5;r.a-=0.015;if(r.a<=0)rippleWaves.splice(i,1);else{rippleCtx.strokeStyle=`rgba(255, 255, 255,${r.a})`;rippleCtx.lineWidth=2;rippleCtx.beginPath();rippleCtx.arc(r.x,r.y,r.r*2+(Math.sin(r.r/5)*5),0,Math.PI*2);rippleCtx.stroke();}}ctx.drawImage(rippleCanvas,0,0);}function gameLoop(){ctx.clearRect(0,0,720,480);drawBackground();drawPath();drawAnimals();drawExplorer();drawUI();updateRipples();if(messageTimer>0){messageTimer--;if(messageTimer===0){message="";}}window.requestAnimationFrame(gameLoop);}document.addEventListener("keydown",e=>{if(e.key in keys){keys[e.key]=true;}});document.addEventListener("keyup",e=>{if(e.key in keys){keys[e.key]=false;}if(currentQuestion){if(e.key==="Backspace"){inputAnswer=inputAnswer.slice(0,-1);}else if(/[0-9]/.test(e.key)&&inputAnswer.length<3){inputAnswer+=e.key;}else if(e.key==="Enter"){if(inputAnswer.length>0){const userAns=parseInt(inputAnswer);if(userAns===currentQuestion.answer){sounds.correct.play();message="Correct! You helped the animal!";}else{sounds.incorrect.play();message=`Oops! The answer was ${currentQuestion.answer}`;}messageTimer=180;for(let a of animals){if(a.mathQ===currentQuestion){a.mathQ=null;break;}}currentQuestion=null;inputAnswer="";}}}else if(e.key==="Enter"){handleInteractions();}});function update(){updateExplorer();if(!currentQuestion)handleInteractions();setTimeout(update,1000/60);}update();gameLoop();