const stage=document.getElementById("game-of-the-day-stage");stage.innerHTML="";const canvas=document.createElement("canvas");canvas.width=720;canvas.height=480;stage.appendChild(canvas);const ctx=canvas.getContext("2d");const bgGradient=ctx.createLinearGradient(0,0,0,480);bgGradient.addColorStop(0,"#91c7b1");bgGradient.addColorStop(1,"#d0f4de");const groundGradient=ctx.createLinearGradient(0,460,0,480);groundGradient.addColorStop(0,"#4a7131");groundGradient.addColorStop(1,"#a1d490");const explorerColor="#fa6e59";const explorerShadow="rgba(250,110,89,0.7)";const friendColor="#5c95d6";const friendShadow="rgba(92,149,214,0.7)";const treasureGlow="#f8de7e";const textColor="#303030";const soundCorrect=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");const soundWrong=new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg");const bgMusic=new Audio("https://cdn.pixabay.com/download/audio/2021/08/04/audio_742cd08e17.mp3?filename=mellow-acoustic-guitar-ambient-11490.mp3");bgMusic.loop=true;bgMusic.volume=0.05;bgMusic.play();let explorer={x:360,y:400,w:40,h:60,vy:0,jumping:false,sparkles:[],sparkleTimer:0};let friend={x:120,y:390,w:40,h:60,bob:0,bobDir:1};let trees=[];let treasures=[];let treasuresFound=0;let currentQuestion=null;let questionActive=false;const gravity=0.8;const jumpForce=-15;function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}function generateTrees(){trees=[];for(let i=0;i<10;i++){let x=randInt(50,670);let h=randInt(100,180);trees.push({x:x,y:480-h,w:40,h:h})}}function generateTreasures(){treasures=[];let count=0;while(count<5){let x=randInt(60,660);if(!trees.some(t=>Math.abs(t.x-x)<60)){let number=randInt(1,10);treasures.push({x:x,y:420,w:50,h:50,number:number,collected:false,glowPhase:Math.random()*Math.PI*2});count++}}}function drawBackground(){ctx.fillStyle=bgGradient;ctx.fillRect(0,0,720,480);ctx.fillStyle=groundGradient;ctx.fillRect(0,460,720,20);trees.forEach(t=>{ctx.fillStyle="#255020";ctx.shadowColor="rgba(0,0,0,0.2)";ctx.shadowBlur=10;ctx.fillRect(t.x,t.y,t.w,t.h);ctx.shadowBlur=0;ctx.fillStyle="#9de6a8";ctx.beginPath();ctx.ellipse(t.x+20,t.y,42,65,0,0,Math.PI*2);ctx.fill()})}function drawExplorer(){ctx.save();ctx.shadowColor=explorerShadow;ctx.shadowBlur=18;ctx.fillStyle=explorerColor;ctx.fillRect(explorer.x,explorer.y,explorer.w,explorer.h);ctx.shadowBlur=0;ctx.fillStyle="#ffe2d2";ctx.beginPath();ctx.arc(explorer.x+20,explorer.y+20,16,0,Math.PI*2);ctx.fill();ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(explorer.x+13,explorer.y+18,5.5,0,Math.PI*2);ctx.arc(explorer.x+27,explorer.y+18,5.5,0,Math.PI*2);ctx.fill();ctx.fillStyle="#000";ctx.beginPath();ctx.arc(explorer.x+13,explorer.y+18,2.5,0,Math.PI*2);ctx.arc(explorer.x+27,explorer.y+18,2.5,0,Math.PI*2);ctx.fill();ctx.strokeStyle=explorerColor;ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(explorer.x+6,explorer.y+52);ctx.lineTo(explorer.x+34,explorer.y+52);ctx.stroke();ctx.restore();if(explorer.sparkleTimer>0){explorer.sparkleTimer--;for(let s of explorer.sparkles){ctx.fillStyle=`rgba(250,110,89,${s.a})`;ctx.beginPath();ctx.arc(explorer.x+s.x,explorer.y+s.y,s.r,0,Math.PI*2);ctx.fill();s.a-=0.02;if(s.a<=0)s.a=0}}else if(Math.random()<0.01){for(let i=0;i<7;i++){explorer.sparkles.push({x:randInt(0,explorer.w),y:randInt(0,explorer.h),r:randInt(1,3),a:1})}explorer.sparkleTimer=80}}function drawFriend(){friend.bob+=friend.bobDir*0.03;if(friend.bob>0.6||friend.bob<-0.6)friend.bobDir*=-1;ctx.save();ctx.shadowColor=friendShadow;ctx.shadowBlur=10;ctx.fillStyle=friendColor;ctx.fillRect(friend.x,friend.y+friend.bob*5,friend.w,friend.h);ctx.shadowBlur=0;ctx.fillStyle="#fff2d4";ctx.beginPath();ctx.arc(friend.x+20,friend.y+22+friend.bob*5,12,0,Math.PI*2);ctx.fill();ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(friend.x+14,friend.y+18+friend.bob*5,4.5,0,Math.PI*2);ctx.arc(friend.x+26,friend.y+18+friend.bob*5,4.5,0,Math.PI*2);ctx.fill();ctx.fillStyle="#000";ctx.beginPath();ctx.arc(friend.x+14,friend.y+18+friend.bob*5,1.7,0,Math.PI*2);ctx.arc(friend.x+26,friend.y+18+friend.bob*5,1.7,0,Math.PI*2);ctx.fill();ctx.strokeStyle=friendColor;ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(friend.x+7,friend.y+48+friend.bob*5);ctx.lineTo(friend.x+33,friend.y+48+friend.bob*5);ctx.stroke();ctx.restore()}function drawTreasures(){treasures.forEach(t=>{if(t.collected)return;const pulse=Math.sin(Date.now()/300+t.glowPhase)*0.2+0.8;ctx.save();ctx.shadowColor=treasureGlow;ctx.shadowBlur=20*pulse;ctx.fillStyle="#fbc02d";ctx.beginPath();ctx.moveTo(t.x+25,t.y);ctx.lineTo(t.x+33*t.w/50,t.y+18*t.h/50);ctx.lineTo(t.x+t.w,t.y+18*t.h/50);ctx.lineTo(t.x+36*t.w/50,t.y+29*t.h/50);ctx.lineTo(t.x+41*t.w/50,t.y+47*t.h/50);ctx.lineTo(t.x+25*t.w/50,t.y+36*t.h/50);ctx.lineTo(t.x+9*t.w/50,t.y+47*t.h/50);ctx.lineTo(t.x+14*t.w/50,t.y+29*t.h/50);ctx.lineTo(t.x,t.y+18*t.h/50);ctx.lineTo(t.x+18*t.w/50,t.y+18*t.h/50);ctx.closePath();ctx.fill();ctx.restore();ctx.fillStyle="#222";ctx.font="bold 22px Comic Sans MS";ctx.textAlign="center";ctx.fillText(t.number,t.x+t.w/2,t.y+t.h/2+4)})}function drawHUD(){ctx.fillStyle=textColor;ctx.font="bold 24px Comic Sans MS";ctx.textAlign="left";ctx.shadowColor="rgba(0,0,0,0.15)";ctx.shadowBlur=3;ctx.fillText("Treasures found: "+treasuresFound+"/5",20,40);ctx.shadowBlur=0;if(questionActive&&currentQuestion){ctx.fillStyle="rgba(255,255,255,0.95)";ctx.strokeStyle="#4a90e2";ctx.lineWidth=3;ctx.shadowColor="rgba(0,0,0,0.15)";ctx.shadowBlur=5;ctx.beginPath();ctx.roundRect(140,60,440,140,15);ctx.fill();ctx.stroke();ctx.shadowBlur=0;ctx.fillStyle="#224477";ctx.font="22px Comic Sans MS";ctx.textAlign="center";ctx.fillText(currentQuestion.text,360,95);ctx.font="18px Comic Sans MS";ctx.fillText("Choose the right answer to pick the treasure!",360,125);for(let i=0;i<currentQuestion.answers.length;i++){let x=220+i*100;let y=140;ctx.fillStyle="#4a90e2";ctx.shadowColor="rgba(74,144,226,0.4)";ctx.shadowBlur=10;ctx.beginPath();ctx.roundRect(x-30,y-25,60,50,12);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#fff";ctx.font="26px Comic Sans MS";ctx.fillText(currentQuestion.answers[i],x,y+8)}}}CanvasRenderingContext2D.prototype.roundRect=function(x,y,w,h,r){if(w<2*r)r=w/2;if(h<2*r)r=h/2;this.beginPath();this.moveTo(x+r,y);this.arcTo(x+w,y,x+w,y+h,r);this.arcTo(x+w,y+h,x,y+h,r);this.arcTo(x,y+h,x,y,r);this.arcTo(x,y,x+w,y,r);this.closePath();return this};function isColliding(a,b){return a.x<a.x+b.w&&a.x+a.w>b.x&&a.y<a.y+b.h&&a.y+a.h>b.y}function checkTreasureCollision(){if(questionActive)return;for(let t of treasures){if(t.collected)continue;if(explorer.x+explorer.w>t.x&&explorer.x<t.x+t.w&&explorer.y+explorer.h>t.y&&explorer.y<t.y+t.h){askQuestion(t);explorer.sparkleTimer=80;explorer.sparkles=[];break}}}function askQuestion(t){questionActive=true;currentQuestion={treasure:t,text:`How many trees do you see near your treasure?`,answers:[]};let nearbyTrees=trees.filter(tree=>Math.abs(tree.x-t.x)<100).length;currentQuestion.correct=nearbyTrees;let options=[nearbyTrees];while(options.length<3){let opt=randInt(0,10);if(!options.includes(opt))options.push(opt)}options.sort(()=>Math.random()-0.5);currentQuestion.answers=options;showQuestion()}function showQuestion(){/* placeholder since drawn in drawHUD */}function selectAnswer(mx,my){if(!questionActive)return;for(let i=0;i<currentQuestion.answers.length;i++){let x=220+i*100;let y=140;if(mx>x-30&&mx<x+30&&my>y-25&&my<y+25){if(currentQuestion.answers[i]===currentQuestion.correct){soundCorrect.currentTime=0;soundCorrect.play();currentQuestion.treasure.collected=true;treasuresFound++;friendSays("Yay! You’re right! Let’s explore more.");}else{soundWrong.currentTime=0;soundWrong.play();friendSays("Oops, try again! Count the trees carefully.");}questionActive=false;currentQuestion=null;}}}let friendSayTimer=0;let friendSayText="";function friendSays(text){friendSayText=text;friendSayTimer=240}function drawFriendSpeech(){if(friendSayTimer>0){friendSayTimer--;ctx.save();ctx.shadowColor="rgba(0,0,0,0.15)";ctx.shadowBlur=6;ctx.fillStyle="rgba(255,255,255,0.95)";ctx.beginPath();ctx.roundRect(friend.x-14,friend.y-50,180,38,15);ctx.fill();ctx.restore();ctx.fillStyle="#2c3e50";ctx.font="18px Comic Sans MS";ctx.textAlign="left";ctx.fillText(friendSayText,friend.x,friend.y-25)}}function updateExplorer(){explorer.vy+=gravity;explorer.y+=explorer.vy;if(explorer.y>400){explorer.y=400;explorer.vy=0;explorer.jumping=false}if(explorer.x<0)explorer.x=0;if(explorer.x+explorer.w>720)explorer.x=720-explorer.w}let keys={};window.addEventListener("keydown",e=>{keys[e.code]=true;if(e.code==="Space"&&!explorer.jumping){explorer.vy=jumpForce;explorer.jumping=true}});window.addEventListener("keyup",e=>{keys[e.code]=false});canvas.addEventListener("click",e=>{const rect=canvas.getBoundingClientRect();let mx=e.clientX-rect.left;let my=e.clientY-rect.top;selectAnswer(mx,my)});function loop(){if(keys["ArrowLeft"]){explorer.x-=5}if(keys["ArrowRight"]){explorer.x+=5}updateExplorer();checkTreasureCollision();drawBackground();drawTreasures();drawExplorer();drawFriend();drawHUD();drawFriendSpeech();requestAnimationFrame(loop)}generateTrees();generateTreasures();friendSays("Hi! I’m Zazu the Explorer! Find treasures and count trees!");loop();