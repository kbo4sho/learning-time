const stage=document.getElementById("game-of-the-day-stage");stage.innerHTML="";const canvas=document.createElement("canvas");canvas.width=720;canvas.height=480;stage.appendChild(canvas);const ctx=canvas.getContext("2d");let keys={};window.addEventListener("keydown",e=>{keys[e.key]=true});window.addEventListener("keyup",e=>{keys[e.key]=false});const tileSize=48;const rows=10;const cols=15;const explorer={x:0,y:0,size:40,color:"#2a66cc",speed:4,collected:0,wavePhase:0};const friendlyCreature={x:0,y:0,size:36,color:"#f5a623",text:"Hi! Find treasures to help me fix my home. Add up the treasures you find!",blinkTimer:0,blinkInterval:3000,blinkDuration:200,eyeOpen:true};const treasures=[];const maxTreasures=8;let targetSum=0;let collectedSum=0;let message="";let bgAudio,correctAudio,wrongAudio,moveAudio;function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}function setupAudio(){bgAudio=new Audio();bgAudio.src="https://actions.google.com/sounds/v1/ambiences/inside_cabin.ogg";bgAudio.loop=true;bgAudio.volume=0.07;bgAudio.play();correctAudio=new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg");correctAudio.volume=0.8;wrongAudio=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");wrongAudio.volume=0.6;moveAudio=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");moveAudio.volume=0.3}function placeTreasures(){while(treasures.length<maxTreasures){const val=randomInt(1,9);const tx=randomInt(1,cols-2);const ty=randomInt(1,rows-2);if(!treasures.find(t=>t.x===tx&&t.y===ty)){treasures.push({x:tx,y:ty,value:val,collected:false,angle:0})}}}function resetGame(){treasures.length=0;placeTreasures();explorer.x=0;explorer.y=0;explorer.collected=0;collectedSum=0;targetSum=randomInt(10,20);message="Help Waggly add treasures to reach "+targetSum;}function drawBackground(){let grad=ctx.createLinearGradient(0,0,0,canvas.height);grad.addColorStop(0,"#e0f7fa");grad.addColorStop(1,"#a7ffeb");ctx.fillStyle=grad;ctx.fillRect(0,0,canvas.width,canvas.height);for(let r=0;r<rows;r++){for(let c=0;c<cols;c++){ctx.fillStyle=((r+c)%2===0)?"#b2dfdb":"#80cbc4";ctx.fillRect(c*tileSize,r*tileSize,tileSize,tileSize);}}ctx.strokeStyle="#4db6ac";ctx.lineWidth=2;for(let r=0;r<=rows;r++){ctx.beginPath();ctx.moveTo(0,r*tileSize);ctx.lineTo(cols*tileSize,r*tileSize);ctx.stroke()}for(let c=0;c<=cols;c++){ctx.beginPath();ctx.moveTo(c*tileSize,0);ctx.lineTo(c*tileSize,rows*tileSize);ctx.stroke()}}function drawExplorer(timestamp){const baseX=explorer.x*tileSize+tileSize/2;const baseY=explorer.y*tileSize+tileSize/2;explorer.wavePhase+=0.1;const waveOffset=Math.sin(explorer.wavePhase)*5;ctx.save();ctx.translate(baseX,baseY+waveOffset);ctx.fillStyle=explorer.color;ctx.shadowColor="rgba(0,0,0,0.25)";ctx.shadowBlur=8;ctx.shadowOffsetX=2;ctx.shadowOffsetY=2;ctx.beginPath();ctx.moveTo(0,-explorer.size/2);ctx.lineTo(explorer.size/2,explorer.size/2);ctx.lineTo(-explorer.size/2,explorer.size/2);ctx.closePath();ctx.fill();ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(0,-explorer.size/6,explorer.size/8,0,Math.PI*2);ctx.fill();ctx.restore()}function drawCreature(timestamp){const cx=(cols-1)*tileSize+tileSize/2;const cy=(rows-1)*tileSize+tileSize/2;friendlyCreature.blinkTimer+=16.6||0;if(friendlyCreature.blinkTimer>friendlyCreature.blinkInterval){friendlyCreature.eyeOpen=false;if(friendlyCreature.blinkTimer>friendlyCreature.blinkInterval+friendlyCreature.blinkDuration){friendlyCreature.eyeOpen=true;friendlyCreature.blinkTimer=0}}ctx.save();ctx.translate(cx,cy);ctx.shadowColor="rgba(0,0,0,0.3)";ctx.shadowBlur=10;ctx.fillStyle=friendlyCreature.color;ctx.beginPath();ctx.ellipse(0,0,22,32,0,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#fff";ctx.beginPath();if(friendlyCreature.eyeOpen){ctx.ellipse(-8,-8,7,10,0,0,Math.PI*2);ctx.ellipse(8,-8,7,10,0,0,Math.PI*2);ctx.fill();ctx.fillStyle="#000";ctx.beginPath();ctx.arc(-8,-8,3.5,0,Math.PI*2);ctx.arc(8,-8,3.5,0,Math.PI*2);ctx.fill()}else{ctx.ellipse(-8,-8,7,2,0,0,Math.PI*2);ctx.ellipse(8,-8,7,2,0,0,Math.PI*2);ctx.fill()}ctx.strokeStyle="#fff";ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(-6,12);ctx.quadraticCurveTo(0,24,6,12);ctx.stroke();ctx.fillStyle="#000";ctx.font="16px Comic Sans MS";ctx.textAlign="center";ctx.shadowColor="rgba(255,255,255,0.8)";ctx.shadowBlur=4;const maxLineLength=30;const words=friendlyCreature.text.split(" ");const lines=[];let currentLine="";for(let w of words){if((currentLine+w).length<=maxLineLength){currentLine+=w+" "}else{lines.push(currentLine.trim());currentLine=w+" "}}if(currentLine)lines.push(currentLine.trim());for(let i=0;i<lines.length;i++){ctx.fillText(lines[i],0,50+i*20)}ctx.shadowBlur=0;ctx.textAlign="left";ctx.restore()}function drawTreasures(timestamp){ctx.font="26px Comic Sans MS";ctx.textAlign="center";ctx.textBaseline="middle";const time=timestamp||0;for(let t of treasures){if(t.collected)continue;t.angle=(t.angle||0)+0.02;const px=t.x*tileSize+tileSize/2;const py=t.y*tileSize+tileSize/2+(Math.sin(t.angle)*5);ctx.save();ctx.translate(px,py);ctx.rotate(t.angle/2);let grad=ctx.createRadialGradient(0,0,5,0,0,20);grad.addColorStop(0,"#fff176");grad.addColorStop(1,"#fbc02d");ctx.fillStyle=grad;ctx.beginPath();ctx.moveTo(0,-18);ctx.lineTo(18,18);ctx.lineTo(-18,18);ctx.closePath();ctx.shadowColor="rgba(0,0,0,0.3)";ctx.shadowBlur=6;ctx.shadowOffsetX=1;ctx.shadowOffsetY=3;ctx.fill();ctx.shadowBlur=0;ctx.fillStyle="#000";ctx.font="bold 26px Comic Sans MS";ctx.fillText(t.value,0,6);ctx.restore()}ctx.textAlign="left"}function drawUI(){ctx.fillStyle="#004d40";ctx.font="24px Comic Sans MS";ctx.shadowColor="rgba(0,0,0,0.3)";ctx.shadowBlur=3;ctx.fillText(`Target Sum: ${targetSum}`,14,28);ctx.fillText(`Collected Sum: ${collectedSum}`,14,62);ctx.fillText(`Treasures Found: ${explorer.collected}/${maxTreasures}`,14,98);ctx.fillStyle="#00695c";ctx.font="20px Comic Sans MS";ctx.fillText(message,14,canvas.height-22);ctx.shadowBlur=0}function checkCollision(a,b){return a.x===b.x&&a.y===b.y}let lastMoveTime=0;let lastPlayMoveSound=0;function collectTreasure(){for(let t of treasures){if(!t.collected&&checkCollision(explorer,t)){t.collected=true;collectedSum+=t.value;explorer.collected++;if(collectedSum===targetSum){message="Amazing! You matched the sum! Waggly's home is safe!";correctAudio.play()}else if(collectedSum>targetSum){message="Oops! You went over the target sum. Try again!";wrongAudio.play();setTimeout(resetGame,1000)}else{message=`Good! You've collected ${collectedSum}, keep going!`;correctAudio.play()}return}}}function moveExplorer(timestamp){if(!lastMoveTime)lastMoveTime=timestamp;if(timestamp-lastMoveTime>250){let moved=false;if(keys.ArrowUp&&explorer.y>0){explorer.y--;moved=true}if(keys.ArrowDown&&explorer.y<rows-1){explorer.y++;moved=true}if(keys.ArrowLeft&&explorer.x>0){explorer.x--;moved=true}if(keys.ArrowRight&&explorer.x<cols-1){explorer.x++;moved=true}if(moved&&timestamp-lastPlayMoveSound>150){moveAudio.currentTime=0;moveAudio.play();lastPlayMoveSound=timestamp}lastMoveTime=timestamp}}function gameLoop(timestamp){moveExplorer(timestamp);collectTreasure();drawBackground();drawTreasures(timestamp);drawExplorer(timestamp);drawCreature(timestamp);drawUI();requestAnimationFrame(gameLoop)}setupAudio();resetGame();requestAnimationFrame(gameLoop);